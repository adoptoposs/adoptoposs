<div id={@id} phx-target={@myself}>
  <%= if assigns[:dropdown] do %>
    <details class="w-full mt-2" open={if @filter_selection_open, do: "open"}>
      <summary class="pl-1 mt-2 text-left text-red-400 hover:text-red-400 border-gray-200 w-full">
        <div class="inline">
          <div class="inline-flex items-center">
            <i class="fa-solid fa-filter mr-1 text-base"></i>
            Set language filters (<%= Enum.count(@filters) %>)
          </div>

          <%= if Enum.count(@filters) > 0 do %>
            <div class="inline float-right">
              <button
                class="button-link button-link--inline leading-none"
                phx-click="clear_filters"
              >
                clear all <i class="fa-solid fa-xmark ml-1.5"></i>
              </button>
            </div>
          <% end %>
        </div>
      </summary>

      <div class="relative">
        <!-- Subscribed languages filters -->
        <div class="bg-gray-200 rounded px-4 py-2 mt-4 font-bold">
          Your favorite languages
          <%= if @user_id do %>
            <span class="float-right">
              <.link navigate={
                Routes.live_path(AdoptopossWeb.Endpoint, AdoptopossWeb.SettingsLive)
              }>
                Edit
              </.link>
            </span>
          <% end %>
        </div>

        <div class="py-4">
          <%= render("subscribed_filters.html",
            id: "#{@id}-subscribed",
            user_id: @user_id,
            tags: @subscribed_tags,
            suggested_tags: @suggested_tags,
            filters: @selected_filters,
            add_event: "select_filter",
            remove_event: "unselect_filter",
            phx_target: @id
          ) %>
        </div>

        <div class="bg-gray-200 rounded px-4 py-2 font-bold">
          Top 10 languages
        </div>

        <div class="py-4">
          <%= render("top_ten_filters.html",
            id: "#{@id}-top-ten",
            tags: Enum.take(@tags, 10),
            filters: @selected_filters,
            add_event: "select_filter",
            remove_event: "unselect_filter",
            phx_target: @id
          ) %>
        </div>

        <div class="bg-gray-200 rounded px-4 py-2 font-bold">
          Search to add language
        </div>

        <div class="py-4">
          <%= render("searchable_filters.html",
            id: "#{@id}-searchable",
            tags: @selected_custom_tags,
            filters: @selected_filters,
            add_event: "select_filter",
            remove_event: "unselect_filter",
            search_event: "search",
            query: @tag_query,
            search_results: @tag_results,
            phx_target: @id
          ) %>
        </div>

        <div class="flex justify-center p-2 py-0">
          <button class="block mt-0" phx-click="apply_filters" phx-target={"##{@id}"}>
            Apply filters
          </button>
        </div>
      </div>
    </details>
  <% else %>
    <div class="block">
      <h3>
        <i class="fa-solid fa-filter mr-1 text-base"></i> Project Filters
      </h3>
      <!-- Subscribed languages filters -->
      <p class="mt-6 px-4 py-2 bg-gray-200 font-bold rounded">
        Your favorite languages
        <%= if @user_id do %>
          <span class="float-right">
            <.link navigate={Routes.live_path(AdoptopossWeb.Endpoint, AdoptopossWeb.SettingsLive)}>
              Edit
            </.link>
          </span>
        <% end %>
      </p>

      <%= render("subscribed_filters.html",
        id: "#{@id}-subscribed",
        user_id: @user_id,
        tags: @subscribed_tags,
        suggested_tags: @suggested_tags,
        filters: @filters,
        add_event: "add_filter",
        remove_event: "remove_filter",
        phx_target: @id
      ) %>
      <!-- Top 10 language filters -->
      <p class="mt-6 px-4 py-2 bg-gray-200 font-bold rounded">
        Top 10 languages
      </p>

      <%= render("top_ten_filters.html",
        id: "#{@id}-top-ten",
        tags: Enum.take(@tags, 10),
        filters: @filters,
        add_event: "add_filter",
        remove_event: "remove_filter",
        phx_target: @id
      ) %>
      <!-- Searchable filters -->
      <p class="mt-6 px-4 py-2 bg-gray-200 font-bold rounded">
        Search to add language
      </p>

      <%= render("searchable_filters.html",
        id: "#{@id}-searchable",
        tags: @custom_tags,
        filters: @filters,
        add_event: "add_filter",
        remove_event: "remove_filter",
        search_event: "search",
        query: @tag_query,
        search_results: @tag_results,
        phx_target: @id
      ) %>
    </div>
  <% end %>
</div>
